<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458</title><meta name="description" content="Documentation for ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458</h2></div><div class="tsd-panel tsd-typography"><a id="md:informe-de-práctica-10-aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic" class="tsd-anchor"></a><h1><a href="#md:informe-de-práctica-10-aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic">Informe de Práctica 10: Aplicación cliente-servidor para coleccionistas de cartas Magic</a></h1><table>
<thead>
<tr>
<th><strong>Autor</strong></th>
<th><strong>Profesor</strong></th>
<th><strong>Asignatura</strong></th>
<th><strong>Universidad</strong></th>
<th><strong>Ubicación</strong></th>
<th><strong>Fecha</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong><em>TOMÁS JAVES TOMMASONE</em></strong></td>
<td><strong><em>Dr. EDUARDO MANUEL SEGREDO GONZALEZ</em></strong></td>
<td><strong><em>DESARROLLO DE SISTEMAS INFORMÁTICOS</em></strong></td>
<td><strong><em>UNIVERSIDAD DE LA LAGUNA</em></strong></td>
<td><strong><em>SAN CRISTOBAL DE LA LAGUNA</em></strong></td>
<td><strong><em>10/04/2024</em></strong></td>
</tr>
</tbody></table>
<a id="md:status-badges" class="tsd-anchor"></a><h2><a href="#md:status-badges">Status Badges</a></h2><p align='center'>
  <a href='https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458/actions/workflows/sonarcloud.yml'>
    <img src='https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458/actions/workflows/sonarcloud.yml/badge.svg' alt = 'Quality Gate Status'>
  </a>

  <a href='https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458/actions/workflows/coveralls.yml'>
    <img src='https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458/actions/workflows/coveralls.yml/badge.svg' alt='Coveralls'>
  </a>

  <a href='https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458/actions/workflows/node.js.yml'>
    <img src='https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458/actions/workflows/node.js.yml/badge.svg' alt='Tests'>
  </a>
</p>

<a id="md:índice" class="tsd-anchor"></a><h2><a href="#md:índice">Índice:</a></h2><ol>
<li><a href="#md:1-objetivo"><em>Objetivo</em></a>  </li>
<li><a href="#md:2-tareas-previas"><em>Tareas Previas</em></a>  </li>
<li><a href="#md:3-arquitectura-de-la-aplicación"><em>Arquitectura de la Aplicación</em></a><br>3.1 <a href="#md:diseño-cliente-servidor"><em>Diseño Cliente-Servidor</em></a><br>3.2 <a href="#md:gestión-de-conexiones"><em>Gestión de Conexiones</em></a><br>3.3 <a href="#md:persistencia-de-datos"><em>Persistencia de Datos</em></a>  </li>
<li><a href="#md:4-implementación-del-servidor"><em>Implementación del Servidor</em></a><br>4.1 <a href="#md:estructura-de-directorios-y-ficheros"><em>Estructura de Directorios y Ficheros</em></a><br>4.2 <a href="#md:manejo-de-peticiones"><em>Manejo de Peticiones</em></a><br>4.3 <a href="#md:código-propuesto-para-el-servidor"><em>Código Propuesto para el Servidor</em></a>    </li>
<li><a href="#md:5-implementación-del-cliente"><em>Implementación del Cliente</em></a><br>5.1 <a href="#md:interfaz-de-línea-de-comandos-cli"><em>Interfaz de Línea de Comandos (CLI)</em></a><br>5.2 <a href="#md:construcción-y-envío-de-peticiones"><em>Construcción y Envío de Peticiones</em></a><br>5.3 <a href="#md:recepción-y-procesamiento-de-respuestas"><em>Recepción y Procesamiento de Respuestas</em></a><br>5.4 <a href="#md:código-propuesto-para-el-cliente"><em>Código Propuesto para el Cliente</em></a>  </li>
<li><a href="#md:6-pruebas-y-validación"><em>Pruebas y Validación</em></a><br>6.1 <a href="#md:metodología-code-then-test"><em>Metodología Code-Then-Test</em></a><br>6.2 <a href="#md:pruebas-implementadas"><em>Pruebas Implementadas</em></a><br>6.3 <a href="#md:automatización-de-pruebas-con-github-actions"><em>Automatización de Pruebas con Github Actions</em></a>  </li>
<li><a href="#md:7-conclusión"><em>Conclusión</em></a>  </li>
<li><a href="#md:8-referencias-bibliográficas"><em>Referencias Bibliográficas</em></a></li>
</ol>
<a id="md:1-objetivo" class="tsd-anchor"></a><h2><a href="#md:1-objetivo">1. Objetivo</a></h2><p>El objetivo de esta práctica es el desarrollo de una aplicación cliente-servidor para la gestión de una colección de cartas Magic, utilizando tecnologías basadas en Node.js. A través de esta aplicación, los usuarios podrán realizar diversas operaciones sobre su colección de cartas, tales como: <strong>añadir, modificar, eliminar, listar y mostrar</strong> detalles específicos de las cartas mediante una interfaz de línea de comandos (CLI).</p>
<p>El servidor se encargará de procesar las solicitudes enviadas por el cliente, interactuar con el sistema de archivos para persistir los datos de las cartas en formato JSON, y responder adecuadamente a cada petición. Por otro lado, el cliente facilitará al usuario una interfaz para interactuar con su colección, formular peticiones y recibir respuestas del servidor.</p>
<p>Con lo descrito anteriormente aseguramos que este proyecto tiene como finalidad poner en práctica y profundizar en el conocimiento de las siguientes áreas:</p>
<ol>
<li><strong>Desarrollo de aplicaciones de red</strong>: A través del uso del módulo net de Node.js, se explorará la creación y gestión de conexiones de red para la comunicación entre el cliente y el servidor.</li>
<li><strong>Programación asíncrona</strong>: Se empleará el módulo events para manejar eventos de manera asíncrona, crucial para el flujo de comunicación y procesamiento de la aplicación.</li>
<li><strong>Interacción con el sistema de archivos</strong>: Utilizando el módulo fs, se gestionará la persistencia de datos en el servidor, familiarizándose con operaciones de lectura y escritura de archivos en un entorno asíncrono.</li>
<li><strong>Creación de interfaces de usuario en CLI</strong>: Mediante los paquetes yargs y chalk, se mejorará la interacción del usuario con la aplicación, proporcionando una interfaz clara y amigable.</li>
</ol>
<a id="md:2-tareas-previas" class="tsd-anchor"></a><h2><a href="#md:2-tareas-previas">2. Tareas Previas</a></h2><p>Antes de comenzar el desarrollo de la aplicación cliente-servidor para la gestión de una colección de cartas Magic, es necesario realizar una serie de tareas previas que aseguren una base sólida para el proyecto. Estas tareas preparatorias son necesarias para familiarizarse con las herramientas y tecnologías que se utilizarán, así como para establecer el entorno de desarrollo adecuado.<br>A continuación, se describen las tareas previas esenciales para este proyecto:</p>
<ol>
<li><p><em>Aceptación de la Asignación en GitHub Classroom</em><br>El primer paso involucra aceptar la asignación de GitHub Classroom proporcionada por el profesorado. Esto creará automáticamente un repositorio en GitHub donde se almacenará todo el código y documentación relacionada con el proyecto. Es importante familiarizarse con las funcionalidades de GitHub, ya que será la plataforma principal para el control de versiones y colaboración durante el desarrollo de la aplicación.</p>
</li>
<li><p><em>Instalación de Node.js y npm</em><br>Es necesario tener instalado <em>Node.js</em>, ya que es el entorno de ejecución para JavaScript del lado del servidor utilizado en el proyecto. npm, el gestor de paquetes de Node.js, permitirá instalar y gestionar las dependencias necesarias para el proyecto.</p>
</li>
<li><p><em>Familiarización con el Módulo net de Node.js</em><br>El módulo <em>net</em> proporciona una API asincrónica para la creación de aplicaciones de red, incluyendo <em>servidores</em> y <em>clientes</em> TCP, por ello, revisamos la documentación oficial de Node.js para comprender cómo utilizar este módulo para establecer conexiones de red, escuchar peticiones y enviar respuestas.</p>
</li>
<li><p><em>Estudio de la Clase EventEmitter y el Módulo events</em><br>El manejo de eventos asíncronos es una parte crucial del desarrollo en Node.js. La clase <em>EventEmitter</em> del módulo events permite implementar patrones de diseño basados en eventos. Es esencial entender cómo <em>crear, emitir y escuchar</em> eventos personalizados para el flujo de comunicación entre el cliente y el servidor.</p>
</li>
<li><p><em>Exploración del Módulo fs</em><br>El módulo <em>fs</em> (File System) de Node.js se utilizará para interactuar con el sistema de archivos, permitiendo <em>leer y escribir archivos</em>. Dado que la persistencia de datos de las cartas se manejará a través de archivos JSON, es importante familiarizarse con las operaciones de archivo asincrónicas que ofrece el módulo fs.</p>
</li>
<li><p><em>Uso de los Paquetes yargs y chalk</em><br>El paquete <em>yargs</em> facilita la creación de <em>interfaces de línea de comandos (CLI) complejas</em>, permitiendo procesar los argumentos y opciones suministrados por el usuario. Por otro lado, <em>chalk</em> se utilizará para añadir <em>color a la salida de la consola</em>, mejorando la legibilidad de los mensajes. Revisamos entonces la documentación de ambos paquetes para entender su instalación y uso básico.</p>
</li>
</ol>
<p>Realizar estas tareas previas nos proporciona una base firme para el desarrollo exitoso de la aplicación cliente-servidor, asegurando que el entorno de desarrollo esté correctamente configurado y que haya un entendimiento sólido de las tecnologías clave involucradas en el proyecto.</p>
<a id="md:3-arquitectura-de-la-aplicación" class="tsd-anchor"></a><h2><a href="#md:3-arquitectura-de-la-aplicación">3. Arquitectura de la Aplicación</a></h2><p>La aplicación para la gestión de colecciones de cartas Magic se basa en una arquitectura <strong>cliente-servidor</strong>, donde el servidor actúa como un punto central de procesamiento y almacenamiento de datos, y el cliente como la interfaz a través de la cual los usuarios interactúan con la aplicación.</p>
<a id="md:diseño-cliente-servidor" class="tsd-anchor"></a><h3><a href="#md:diseño-cliente-servidor">Diseño Cliente-Servidor</a></h3><p>En el patrón de arquitectura cliente-servidor utilizado, el <strong>servidor</strong> es responsable de la lógica de negocio y de gestionar el acceso a los datos de las cartas Magic, que se almacenan en el sistema de archivos del servidor en formato JSON. Este espera las conexiones de los clientes, procesa sus peticiones (como añadir, modificar, eliminar, listar y mostrar cartas), realiza las operaciones solicitadas sobre los datos, y devuelve las respuestas apropiadas.</p>
<p>El <strong>cliente</strong> se implementa como una aplicación de línea de comandos (CLI) que permite a los usuarios enviar comandos y datos al servidor. Los usuarios pueden interactuar con su colección de cartas a través de este CLI, enviando peticiones al servidor y recibiendo respuestas con la información solicitada o confirmaciones de las operaciones realizadas.</p>
<a id="md:gestión-de-conexiones" class="tsd-anchor"></a><h3><a href="#md:gestión-de-conexiones">Gestión de Conexiones</a></h3><p>Para manejar múltiples peticiones de diferentes clientes simultáneamente, el servidor utiliza el módulo net de Node.js, que permite gestionar conexiones TCP de manera asincrónica. Cada vez que un cliente se conecta al servidor, se establece una nueva conexión TCP. El servidor procesa cada petición en su propio flujo de ejecución, permitiendo así que múltiples clientes interactúen con la aplicación de manera concurrente sin bloqueos.</p>
<p>El servidor está diseñado para ser eficiente en la gestión de estas conexiones, asegurando que las peticiones se procesen rápidamente y que los recursos del sistema se utilicen de manera óptima. La arquitectura asincrónica de Node.js facilita esta capacidad, permitiendo al servidor responder a otras peticiones mientras espera que operaciones de E/S, como la lectura o escritura de archivos, se completen.</p>
<a id="md:persistencia-de-datos" class="tsd-anchor"></a><h3><a href="#md:persistencia-de-datos">Persistencia de Datos</a></h3><p>La persistencia de datos se logra almacenando la información de las cartas Magic en ficheros JSON dentro del sistema de archivos del servidor. Cada carta se almacena en un fichero separado, lo que simplifica la gestión de las colecciones individuales de los usuarios.</p>
<p>Para cada usuario, se crea un directorio específico que contiene los ficheros JSON de las cartas de su colección. Esto permite una organización clara de los datos y facilita operaciones como la adición, modificación y eliminación de cartas, ya que cada operación puede dirigirse a un fichero específico dentro del directorio del usuario.</p>
<p>El servidor utiliza el módulo fs de Node.js para interactuar con el sistema de archivos de manera asíncrona, lo que asegura que las operaciones de E/S no bloqueen el procesamiento de otras peticiones. Esta estrategia de persistencia garantiza que los datos de los usuarios estén siempre disponibles y actualizados, permitiendo una recuperación eficiente y proporcionando una base sólida para la gestión de las colecciones de cartas.</p>
<a id="md:4-implementación-del-servidor" class="tsd-anchor"></a><h2><a href="#md:4-implementación-del-servidor">4. Implementación del Servidor</a></h2><p>La implementación del servidor en la aplicación cliente-servidor para la gestión de colecciones de cartas Magic se centra en dos aspectos principales:  </p>
<ul>
<li>La organización del almacenamiento de datos a través de una estructura de directorios y ficheros.</li>
<li>El procesamiento eficaz de las peticiones recibidas de los clientes, junto con el envío de las respuestas correspondientes.</li>
</ul>
<a id="md:estructura-de-directorios-y-ficheros" class="tsd-anchor"></a><h3><a href="#md:estructura-de-directorios-y-ficheros">Estructura de Directorios y Ficheros</a></h3><p>El servidor organiza los datos de las colecciones de cartas de cada usuario en una estructura de directorios y ficheros clara y sistemática. Cada usuario tiene asignado un directorio único basado en su identificador o nombre de usuario. Dentro de este directorio, cada carta de la colección se almacena en un fichero JSON individual, nombrado con el ID único de la carta. Esta estructura facilita la búsqueda, modificación y eliminación de cartas específicas dentro de la colección de un usuario.</p>
<ul>
<li>La estructura se vería así:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-0">/</span><span class="hl-1">data</span><br/><span class="hl-0">  /</span><span class="hl-1">usuario1</span><br/><span class="hl-0">    1.</span><span class="hl-1">json</span><br/><span class="hl-0">    2.</span><span class="hl-1">json</span><br/><span class="hl-0">  /</span><span class="hl-1">usuario2</span><br/><span class="hl-0">    1.</span><span class="hl-1">json</span><br/><span class="hl-0">    3.</span><span class="hl-1">json</span>
</code><button>Copy</button></pre>
<p>En este ejemplo, el directorio <em>/data</em> contiene subdirectorios para cada usuario (usuario1, usuario2), y cada subdirectorio contiene ficheros JSON para las cartas individuales (1.json, 2.json, etc.).</p>
<a id="md:manejo-de-peticiones" class="tsd-anchor"></a><h3><a href="#md:manejo-de-peticiones">Manejo de Peticiones</a></h3><p>Como se comentaba anteriormente, el servidor procesa las peticiones utilizando el módulo net de Node.js. Al recibir una petición, el servidor determina la acción solicitada (añadir, modificar, eliminar, listar o mostrar una carta) y los datos asociados a esa petición. Luego, realiza la operación correspondiente sobre los ficheros del sistema de archivos y devuelve una respuesta al cliente. Las respuestas pueden incluir la confirmación de la acción realizada, los datos solicitados de cartas específicas, o mensajes de error en caso de problemas.</p>
<p>El procesamiento de las peticiones y el envío de respuestas se manejan de manera asíncrona, asegurando que el servidor pueda atender múltiples peticiones de forma concurrente sin bloqueos.</p>
<a id="md:código-propuesto-para-el-servidor" class="tsd-anchor"></a><h3><a href="#md:código-propuesto-para-el-servidor">Código Propuesto para el Servidor</a></h3><p>El código propuesto para el servidor es el siguiente:</p>
<ul>
<li><em>Server.ts</em>:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-1">net</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-1">fs</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-1">path</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;path&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">EventEmitter</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;events&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">Card</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../Cartas/ICard.js&#39;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">CardRequest</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../Cartas/ICardRequest.js&#39;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">CardCollection</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../Cartas/CardCollection.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cardEventEmitter</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">EventEmitter</span><span class="hl-0">();</span><br/><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">cardCollections</span><span class="hl-0">: { [</span><span class="hl-1">key</span><span class="hl-0">: </span><span class="hl-7">string</span><span class="hl-0">]: </span><span class="hl-7">CardCollection</span><span class="hl-0"> } = {};</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Evento para añadir una carta a la colección de un usuario.</span><br/><span class="hl-8"> */</span><br/><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;add&#39;</span><span class="hl-0">, (</span><span class="hl-1">connection</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cardCollection</span><span class="hl-0"> = </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] || </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] = </span><span class="hl-1">cardCollection</span><span class="hl-0">; </span><span class="hl-8">// Guardamos la colección actualizada</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">answer</span><span class="hl-0"> = </span><span class="hl-1">cardCollection</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">carta</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-1">answer</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">end</span><span class="hl-0">());</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Evento para eliminar una carta de la colección de un usuario.</span><br/><span class="hl-8"> */</span><br/><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;remove&#39;</span><span class="hl-0">, (</span><span class="hl-1">connection</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cardCollection</span><span class="hl-0"> = </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] || </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] = </span><span class="hl-1">cardCollection</span><span class="hl-0">; </span><span class="hl-8">// Guardamos la colección actualizada</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">answer</span><span class="hl-0"> = </span><span class="hl-1">cardCollection</span><span class="hl-0">.</span><span class="hl-6">removeCard</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">carta</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-1">answer</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">end</span><span class="hl-0">());</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Evento para actualizar una carta de la colección de un usuario.</span><br/><span class="hl-8"> */</span><br/><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;update&#39;</span><span class="hl-0">, (</span><span class="hl-1">connection</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cardCollection</span><span class="hl-0"> = </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] || </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] = </span><span class="hl-1">cardCollection</span><span class="hl-0">; </span><span class="hl-8">// Guardamos la colección actualizada</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">answer</span><span class="hl-0"> = </span><span class="hl-1">cardCollection</span><span class="hl-0">.</span><span class="hl-6">updateCard</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">carta</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-1">answer</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">end</span><span class="hl-0">());</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Evento para leer una carta de la colección de un usuario.</span><br/><span class="hl-8"> */</span><br/><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;read&#39;</span><span class="hl-0">, (</span><span class="hl-1">connection</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cardCollection</span><span class="hl-0"> = </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] || </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] = </span><span class="hl-1">cardCollection</span><span class="hl-0">; </span><span class="hl-8">// Guardamos la colección actualizada</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">answer</span><span class="hl-0"> = </span><span class="hl-1">cardCollection</span><span class="hl-0">.</span><span class="hl-6">readCard</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">carta</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-1">answer</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">end</span><span class="hl-0">());</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Evento para listar las cartas de la colección de un usuario.</span><br/><span class="hl-8"> */</span><br/><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;list&#39;</span><span class="hl-0">, (</span><span class="hl-1">connection</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cardCollection</span><span class="hl-0"> = </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] || </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] = </span><span class="hl-1">cardCollection</span><span class="hl-0">; </span><span class="hl-8">// Guardamos la colección actualizada</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">answer</span><span class="hl-0"> = </span><span class="hl-1">cardCollection</span><span class="hl-0">.</span><span class="hl-6">listCards</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-1">answer</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">end</span><span class="hl-0">());</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Evento por defecto.</span><br/><span class="hl-8"> */</span><br/><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;default&#39;</span><span class="hl-0">, (</span><span class="hl-1">connection</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-3">&#39;Comando no reconocido.</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">end</span><span class="hl-0">();</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Servidor que permite añadir cartas a la colección de un usuario.</span><br/><span class="hl-8"> */</span><br/><span class="hl-2">export</span><span class="hl-0"> </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">server</span><span class="hl-0"> = </span><span class="hl-1">net</span><span class="hl-0">.</span><span class="hl-6">createServer</span><span class="hl-0">(</span><span class="hl-1">connection</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">requestData</span><span class="hl-0"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">; </span><span class="hl-8">// Variable para almacenar los datos recibidos</span><br/><br/><span class="hl-0">  </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">requestData</span><span class="hl-0"> += </span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">(); </span><span class="hl-8">// Concatenamos los datos recibidos</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// Verificamos si se ha recibido el delimitador</span><br/><span class="hl-0">    </span><span class="hl-2">try</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">request</span><span class="hl-0"> = </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">parse</span><span class="hl-0">(</span><span class="hl-1">requestData</span><span class="hl-0">.</span><span class="hl-6">trim</span><span class="hl-0">()) </span><span class="hl-2">as</span><span class="hl-0"> </span><span class="hl-7">CardRequest</span><span class="hl-0">; </span><span class="hl-8">// Eliminamos espacios en blanco y convertimos a objeto JSON</span><br/><span class="hl-0">      </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-3">&#39;Cliente operando:&#39;</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-8">// Verificamos si ya hay una instancia de CardCollection para este usuario</span><br/><span class="hl-0">      </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">cardCollections</span><span class="hl-0">: { [</span><span class="hl-1">key</span><span class="hl-0">: </span><span class="hl-7">string</span><span class="hl-0">]: </span><span class="hl-7">CardCollection</span><span class="hl-0"> } = {};</span><br/><br/><span class="hl-0">      </span><span class="hl-8">// Si no existe la propiedad cardCollections en el objeto global, la creamos</span><br/><span class="hl-0">      </span><span class="hl-2">if</span><span class="hl-0"> (!</span><span class="hl-1">cardCollections</span><span class="hl-0">.</span><span class="hl-6">hasOwnProperty</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">)) {</span><br/><span class="hl-0">        </span><span class="hl-8">// Si no hay una instancia, la creamos y la almacenamos en el objeto cardCollections</span><br/><span class="hl-0">        </span><span class="hl-1">cardCollections</span><span class="hl-0">[</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">] = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">usuario</span><span class="hl-0">);</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">      </span><br/><span class="hl-0">      </span><span class="hl-8">// Emitimos un evento basado en el comando recibido o &#39;default&#39; si el comando no se reconoce</span><br/><span class="hl-0">      </span><span class="hl-2">if</span><span class="hl-0"> (</span><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">listenerCount</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">comando</span><span class="hl-0">) &gt; </span><span class="hl-10">0</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">emit</span><span class="hl-0">(</span><span class="hl-1">request</span><span class="hl-0">.</span><span class="hl-1">comando</span><span class="hl-0">, </span><span class="hl-1">connection</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">);</span><br/><span class="hl-0">      } </span><span class="hl-2">else</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-1">cardEventEmitter</span><span class="hl-0">.</span><span class="hl-6">emit</span><span class="hl-0">(</span><span class="hl-3">&#39;default&#39;</span><span class="hl-0">, </span><span class="hl-1">connection</span><span class="hl-0">, </span><span class="hl-1">request</span><span class="hl-0">);</span><br/><span class="hl-0">      }</span><br/><span class="hl-0"> </span><br/><span class="hl-0">    } </span><span class="hl-2">catch</span><span class="hl-0"> (</span><span class="hl-1">error</span><span class="hl-0">) {</span><br/><span class="hl-0">      </span><span class="hl-1">connection</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-3">&#39;Error al procesar la petición: formato inválido.</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-1">requestData</span><span class="hl-0"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">; </span><span class="hl-8">// Reiniciamos la variable para la próxima petición</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">});</span><br/><br/><span class="hl-8">// Escuchamos en el puerto 2424</span><br/><span class="hl-1">server</span><span class="hl-0">.</span><span class="hl-6">listen</span><span class="hl-0">(</span><span class="hl-10">2424</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-3">&#39;Servidor esperando conexiones...&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">});</span>
</code><button>Copy</button></pre>
<a id="md:5-implementación-del-cliente" class="tsd-anchor"></a><h2><a href="#md:5-implementación-del-cliente">5. Implementación del Cliente</a></h2><p>Como dijimos anteriormente, la implementación del cliente en nuestra aplicación cliente-servidor para la gestión de colecciones de cartas Magic se realiza a través de una Interfaz de Línea de Comandos (CLI). Esta interfaz permite a los usuarios interactuar directamente con el servidor para realizar operaciones sobre su colección de cartas. A continuación, detallamos cómo se abordan los aspectos clave de la implementación del cliente utilizando esta estructura.</p>
<a id="md:interfaz-de-línea-de-comandos-cli" class="tsd-anchor"></a><h3><a href="#md:interfaz-de-línea-de-comandos-cli">Interfaz de Línea de Comandos (CLI)</a></h3><p>El diseño de la CLI se realiza utilizando el paquete <em>yargs</em>, el cual facilita la creación de interfaces de usuario en la línea de comandos robustas y bien estructuradas. Yargs permite definir comandos, argumentos y opciones que el usuario puede emplear para interactuar con la aplicación. Cada comando corresponde a una operación específica que el usuario puede realizar, como añadir una nueva carta a la colección, listar todas las cartas, o eliminar una carta específica.</p>
<a id="md:construcción-y-envío-de-peticiones" class="tsd-anchor"></a><h3><a href="#md:construcción-y-envío-de-peticiones">Construcción y Envío de Peticiones</a></h3><p>Cuando el usuario ejecuta un comando a través de la CLI, el cliente construye una petición basada en la acción solicitada y los datos proporcionados. Esta petición se serializa a un formato JSON y se envía al servidor utilizando una conexión TCP establecida por el módulo net de Node.js. Este proceso se maneja de manera asíncrona para no bloquear la interfaz de usuario mientras se espera la respuesta del servidor.</p>
<a id="md:recepción-y-procesamiento-de-respuestas" class="tsd-anchor"></a><h3><a href="#md:recepción-y-procesamiento-de-respuestas">Recepción y Procesamiento de Respuestas</a></h3><p>Una vez que el servidor ha procesado la petición, envía una respuesta de vuelta al cliente. El cliente deserializa esta respuesta de su formato JSON y la procesa para determinar el resultado de la operación solicitada. Dependiendo de la respuesta, el cliente puede mostrar al usuario un mensaje de éxito, los datos solicitados (por ejemplo, los detalles de una carta específica), o un mensaje de error si la operación no pudo completarse correctamente.</p>
<p>El uso del paquete chalk mejora la legibilidad de los mensajes mostrados al usuario, permitiendo, por ejemplo, resaltar en colores distintos los mensajes de éxito, error, o los datos importantes.</p>
<a id="md:código-propuesto-para-el-cliente" class="tsd-anchor"></a><h3><a href="#md:código-propuesto-para-el-cliente">Código Propuesto para el Cliente</a></h3><p>El código propuesto para el cliente es el siguiente:</p>
<ul>
<li><em>Cliente.ts</em>:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-1">net</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;net&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-1">yargs</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;yargs&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">EventEmitter</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;events&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">hideBin</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;yargs/helpers&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">argv</span><span class="hl-0"> = </span><span class="hl-6">yargs</span><span class="hl-0">(</span><span class="hl-6">hideBin</span><span class="hl-0">(</span><span class="hl-1">process</span><span class="hl-0">.</span><span class="hl-1">argv</span><span class="hl-0">))</span><br/><span class="hl-0">  .</span><span class="hl-6">command</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-1">command:</span><span class="hl-0"> </span><span class="hl-3">&#39;add&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Añade una nueva carta a la colección de un usuario&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">builder:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">user:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Nombre del usuario&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;ID de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Nombre de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Coste de mana&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Color de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Línea o tipo de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Rareza de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Fuerza y resistencia de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;array&#39;</span><span class="hl-0">, </span><span class="hl-1">default:</span><span class="hl-0"> [] },</span><br/><span class="hl-0">      </span><span class="hl-1">marcasLealtad:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Marcas de lealtad de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Valor de mercado de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> }</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-6">handler</span><span class="hl-1">:</span><span class="hl-0"> (</span><span class="hl-1">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">requestData</span><span class="hl-0"> = {</span><br/><span class="hl-0">        </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&#39;add&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">carta:</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">nombre</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">costeMana</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">color</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">líneaTipo</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">rareza</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">textoReglas</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">fuerzaResistencia</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">marcasLealtad:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">marcasLealtad</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">valorMercado</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      };</span><br/><span class="hl-0">      </span><span class="hl-6">sendDataToServer</span><span class="hl-0">(</span><span class="hl-1">requestData</span><span class="hl-0">, </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  })</span><br/><span class="hl-0">  .</span><span class="hl-6">command</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-1">command:</span><span class="hl-0"> </span><span class="hl-3">&#39;list&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Lista todas las cartas de la colección de un usuario&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">builder:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">user:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Nombre del usuario&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> }</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-6">handler</span><span class="hl-1">:</span><span class="hl-0"> (</span><span class="hl-1">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">requestData</span><span class="hl-0"> = {</span><br/><span class="hl-0">        </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&#39;list&#39;</span><br/><span class="hl-0">      };</span><br/><span class="hl-0">      </span><span class="hl-6">sendDataToServer</span><span class="hl-0">(</span><span class="hl-1">requestData</span><span class="hl-0">, </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  })</span><br/><span class="hl-0">  .</span><span class="hl-6">command</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-1">command:</span><span class="hl-0"> </span><span class="hl-3">&#39;update&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Actualiza una carta de la colección de un usuario&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">builder:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">user:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Nombre del usuario&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;ID de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Nombre de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Coste de mana&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Color de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Línea o tipo de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Rareza de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Fuerza y resistencia de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;array&#39;</span><span class="hl-0">, </span><span class="hl-1">default:</span><span class="hl-0"> [] },</span><br/><span class="hl-0">      </span><span class="hl-1">marcasLealtad:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Marcas de lealtad de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Valor de mercado de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> }</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-6">handler</span><span class="hl-1">:</span><span class="hl-0"> (</span><span class="hl-1">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">requestData</span><span class="hl-0"> = {</span><br/><span class="hl-0">        </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&#39;update&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">carta:</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">nombre</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">costeMana</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">color</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">líneaTipo</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">rareza</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">textoReglas</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">fuerzaResistencia</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">marcasLealtad:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">marcasLealtad</span><span class="hl-0">,</span><br/><span class="hl-0">          </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">valorMercado</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      };</span><br/><span class="hl-0">      </span><span class="hl-6">sendDataToServer</span><span class="hl-0">(</span><span class="hl-1">requestData</span><span class="hl-0">, </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  })</span><br/><span class="hl-0">  .</span><span class="hl-6">command</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-1">command:</span><span class="hl-0"> </span><span class="hl-3">&#39;read&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Lee una carta de la colección de un usuario&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">builder:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">user:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Nombre del usuario&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;ID de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> }</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-6">handler</span><span class="hl-1">:</span><span class="hl-0"> (</span><span class="hl-1">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">requestData</span><span class="hl-0"> = {</span><br/><span class="hl-0">        </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&#39;read&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">carta:</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">id</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      };</span><br/><span class="hl-0">      </span><span class="hl-6">sendDataToServer</span><span class="hl-0">(</span><span class="hl-1">requestData</span><span class="hl-0">, </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  })</span><br/><span class="hl-0">  .</span><span class="hl-6">command</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-1">command:</span><span class="hl-0"> </span><span class="hl-3">&#39;remove&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Elimina una carta de la colección de un usuario&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">builder:</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">user:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;Nombre del usuario&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;string&#39;</span><span class="hl-0"> },</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> { </span><span class="hl-1">describe:</span><span class="hl-0"> </span><span class="hl-3">&#39;ID de la carta&#39;</span><span class="hl-0">, </span><span class="hl-1">demandOption:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0">, </span><span class="hl-1">type:</span><span class="hl-0"> </span><span class="hl-3">&#39;number&#39;</span><span class="hl-0"> }</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-6">handler</span><span class="hl-1">:</span><span class="hl-0"> (</span><span class="hl-1">argv</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">requestData</span><span class="hl-0"> = {</span><br/><span class="hl-0">        </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&#39;remove&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">carta:</span><span class="hl-0"> {</span><br/><span class="hl-0">          </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">id</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">      };</span><br/><span class="hl-0">      </span><span class="hl-6">sendDataToServer</span><span class="hl-0">(</span><span class="hl-1">requestData</span><span class="hl-0">, </span><span class="hl-1">argv</span><span class="hl-0">.</span><span class="hl-1">user</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  })</span><br/><span class="hl-0">  </span><br/><span class="hl-0">  .</span><span class="hl-6">help</span><span class="hl-0">()</span><br/><span class="hl-0">  .</span><span class="hl-1">argv</span><span class="hl-0">;</span><br/><br/><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">responseEmitter</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">EventEmitter</span><span class="hl-0">();</span><br/><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * </span><span class="hl-4">@brief</span><span class="hl-8"> Función que envía los datos al servidor.</span><br/><span class="hl-8"> * </span><span class="hl-4">@param</span><span class="hl-8"> </span><span class="hl-1">data</span><span class="hl-8"> Datos a enviar.</span><br/><span class="hl-8"> * </span><span class="hl-4">@returns</span><span class="hl-8"> void</span><br/><span class="hl-8"> */</span><br/><span class="hl-4">function</span><span class="hl-0"> </span><span class="hl-6">sendDataToServer</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">: </span><span class="hl-7">any</span><span class="hl-0">, </span><span class="hl-1">user</span><span class="hl-0">: </span><span class="hl-7">string</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-8">// Creamos un nuevo socket</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">client</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-1">net</span><span class="hl-0">.</span><span class="hl-6">Socket</span><span class="hl-0">();</span><br/><br/><span class="hl-0">  </span><span class="hl-8">// Nos conectamos al servidor</span><br/><span class="hl-0">  </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">connect</span><span class="hl-0">(</span><span class="hl-10">2424</span><span class="hl-0">, </span><span class="hl-3">&#39;localhost&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-3">&#39;Conectado al servidor.&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-8">// Enviamos los datos al servidor</span><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">) + </span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-8">// Escuchamos la respuesta del servidor</span><br/><span class="hl-0">  </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, (</span><span class="hl-1">data</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">());</span><br/><span class="hl-0">    </span><span class="hl-1">responseEmitter</span><span class="hl-0">.</span><span class="hl-6">emit</span><span class="hl-0">(</span><span class="hl-3">&#39;response&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">());</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-8">// Cerramos la conexión</span><br/><span class="hl-0">  </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;close&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0">(</span><span class="hl-3">&#39;&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">}</span>
</code><button>Copy</button></pre>
<a id="md:6-pruebas-y-validación" class="tsd-anchor"></a><h2><a href="#md:6-pruebas-y-validación">6. Pruebas y Validación</a></h2><p>En el desarrollo de la aplicación cliente-servidor para la gestión de colecciones de cartas Magic, hemos adoptado un enfoque práctico orientado a la implementación de código seguido por pruebas. Este enfoque, conocido comúnmente como &quot;code-then-test&quot;, consiste en escribir primero el código de la aplicación y, posteriormente, desarrollar las pruebas unitarias y de integración que validan la correcta funcionalidad de los componentes implementados.</p>
<a id="md:metodología-code-then-test" class="tsd-anchor"></a><h3><a href="#md:metodología-code-then-test">Metodología Code-Then-Test</a></h3><p>Aunque este enfoque difiere del Test-Driven Development (TDD), donde las pruebas se escriben antes del código, sigue siendo esencial para garantizar la calidad y fiabilidad del software. La metodología &quot;code-then-test&quot; permite a los desarrolladores tener una visión más clara de las funcionalidades completas y sus interacciones antes de definir las pruebas específicas. Esto es particularmente útil en etapas tempranas de desarrollo, donde los requisitos pueden ser más flexibles o sujetos a cambios.</p>
<p>Una vez que una funcionalidad está implementada, se procede a escribir pruebas unitarias y de integración que aseguran que el código cumple con los requisitos especificados y funciona correctamente en conjunto con otros componentes del sistema. Este enfoque también facilita la refactorización y mejora del código, ya que las pruebas posteriores proporcionan una red de seguridad que permite modificar el código con confianza.</p>
<a id="md:pruebas-implementadas" class="tsd-anchor"></a><h3><a href="#md:pruebas-implementadas">Pruebas Implementadas</a></h3><p>Las pruebas para testear el correcto funcionamiento del programa (tanto por parte del servidor como del cliente) son las siguientes:</p>
<ul>
<li><em>Cliente-Server.spec.ts</em>:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-8">// test/server.test.js</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-3">&quot;mocha&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">expect</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;chai&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-4">*</span><span class="hl-0"> </span><span class="hl-2">as</span><span class="hl-0"> </span><span class="hl-1">net</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;net&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-4">*</span><span class="hl-0"> </span><span class="hl-2">as</span><span class="hl-0"> </span><span class="hl-1">fs</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;fs&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">CardCollection</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;../../src/Cartas/CardCollection.js&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">Color</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;../../src/Cartas/EColor.js&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">TipoLinea</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;../../src/Cartas/ETipoLinea.js&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">Rareza</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;../../src/Cartas/ERareza.js&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">Card</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;../../src/Cartas/ICard.js&quot;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">server</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&quot;../../src/Cliente-Servidor/Server.js&quot;</span><span class="hl-0">;</span><br/><br/><br/><span class="hl-6">describe</span><span class="hl-0">(</span><span class="hl-3">&#39;Servidor de Cartas&#39;</span><span class="hl-0">, </span><span class="hl-4">function</span><span class="hl-0">() {</span><br/><span class="hl-0">  </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">client</span><span class="hl-0">: </span><span class="hl-7">net</span><span class="hl-0">.</span><span class="hl-7">Socket</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">cardCollections</span><span class="hl-0"> = {};</span><br/><br/><span class="hl-0">  </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">colección</span><span class="hl-0">: </span><span class="hl-7">CardCollection</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">usuarioPrueba</span><span class="hl-0"> = </span><span class="hl-3">&#39;testUser2&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">dirPath</span><span class="hl-0"> = </span><span class="hl-3">`./data/</span><span class="hl-4">${</span><span class="hl-1">usuarioPrueba</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-6">after</span><span class="hl-0">(</span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// Cerramos servidor después de todas las pruebas</span><br/><span class="hl-0">    </span><span class="hl-1">server</span><span class="hl-0">.</span><span class="hl-6">close</span><span class="hl-0">(</span><span class="hl-1">done</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-8">// Limpiamos el directorio</span><br/><span class="hl-0">    </span><span class="hl-2">if</span><span class="hl-0"> (</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">rmdirSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">beforeEach</span><span class="hl-0">(</span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// Iniciamos nuevo cliente para cada prueba</span><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-1">net</span><span class="hl-0">.</span><span class="hl-6">Socket</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">connect</span><span class="hl-0">({ </span><span class="hl-1">port:</span><span class="hl-0"> </span><span class="hl-10">2424</span><span class="hl-0"> }, </span><span class="hl-1">done</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// Preparamos el directorio</span><br/><span class="hl-0">    </span><span class="hl-2">if</span><span class="hl-0"> (!</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">mkdirSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">usuarioPrueba</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">afterEach</span><span class="hl-0">(</span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">end</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-6">done</span><span class="hl-0">();</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería responder a un comando &quot;add&quot; válido&#39;</span><span class="hl-0">, </span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">testData</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-3">&quot;testUser2&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&quot;add&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">carta:</span><span class="hl-0"> { </span><br/><span class="hl-0">        </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&quot;testCard&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">tipoLinea:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&quot;prueba&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> [</span><span class="hl-10">1</span><span class="hl-0">, </span><span class="hl-10">1</span><span class="hl-0">],</span><br/><span class="hl-0">        </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">0.5</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">testData</span><span class="hl-0">) + </span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">()).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">include</span><span class="hl-0">(</span><span class="hl-3">&#39;Nueva carta añadida&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-6">done</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería responder a un comando &quot;list&quot; válido&#39;</span><span class="hl-0">, </span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-6">timeout</span><span class="hl-0">(</span><span class="hl-10">5000</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">testData</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-3">&quot;testUser2&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&quot;list&quot;</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">testData</span><span class="hl-0">) + </span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">()).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">include</span><span class="hl-0">(</span><span class="hl-3">&#39;Colección de cartas&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-6">done</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería responder a un comando &quot;update&quot; válido&#39;</span><span class="hl-0">, </span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-6">timeout</span><span class="hl-0">(</span><span class="hl-10">5000</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">testData</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-3">&quot;testUser2&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&quot;update&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">carta:</span><span class="hl-0"> { </span><br/><span class="hl-0">        </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&quot;testCard&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">tipoLinea:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&quot;prueba&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> [</span><span class="hl-10">1</span><span class="hl-0">, </span><span class="hl-10">1</span><span class="hl-0">],</span><br/><span class="hl-0">        </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">0.5</span><br/><span class="hl-0">      }</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">testData</span><span class="hl-0">) + </span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">()).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">include</span><span class="hl-0">(</span><span class="hl-3">&#39;Carta actualizada&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-6">done</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería responder a un comando &quot;read&quot; válido&#39;</span><span class="hl-0">, </span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">this</span><span class="hl-0">.</span><span class="hl-6">timeout</span><span class="hl-0">(</span><span class="hl-10">5000</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">testData</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-3">&quot;testUser2&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&quot;read&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">carta:</span><span class="hl-0"> { </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0"> }</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">testData</span><span class="hl-0">) + </span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">()).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">include</span><span class="hl-0">(</span><span class="hl-3">&#39;Información de la carta con ID&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-6">done</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería responder a un comando &quot;remove&quot; válido&#39;</span><span class="hl-0">, </span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">testData</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-3">&quot;testUser2&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&quot;remove&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">carta:</span><span class="hl-0"> { </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0"> }</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">testData</span><span class="hl-0">) + </span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">()).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">include</span><span class="hl-0">(</span><span class="hl-3">&#39;Carta eliminada&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-6">done</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería responder a un comando desconocido&#39;</span><span class="hl-0">, </span><span class="hl-1">done</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">testData</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">usuario:</span><span class="hl-0"> </span><span class="hl-3">&quot;testUser2&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">comando:</span><span class="hl-0"> </span><span class="hl-3">&quot;unknown&quot;</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">write</span><span class="hl-0">(</span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">testData</span><span class="hl-0">) + </span><span class="hl-3">&#39;</span><span class="hl-9">\n</span><span class="hl-3">&#39;</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-1">client</span><span class="hl-0">.</span><span class="hl-6">on</span><span class="hl-0">(</span><span class="hl-3">&#39;data&#39;</span><span class="hl-0">, </span><span class="hl-1">data</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">data</span><span class="hl-0">.</span><span class="hl-6">toString</span><span class="hl-0">()).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">include</span><span class="hl-0">(</span><span class="hl-3">&#39;Comando no reconocido&#39;</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-6">done</span><span class="hl-0">();</span><br/><span class="hl-0">    });</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">});</span>
</code><button>Copy</button></pre>
<p>Asímismo generamos pruebas para CardCollection (que usa los enums e interfaces):</p>
<ul>
<li><em>CardCollection.spec.ts</em>:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-3">&#39;mocha&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">expect</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;chai&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-4">*</span><span class="hl-0"> </span><span class="hl-2">as</span><span class="hl-0"> </span><span class="hl-1">fs</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;fs&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> </span><span class="hl-1">chalk</span><span class="hl-0"> </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;chalk&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">CardCollection</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../../src/Cartas/CardCollection.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">Card</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../../src/Cartas/ICard.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">Color</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../../src/Cartas/EColor.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">TipoLinea</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../../src/Cartas/ETipoLinea.js&#39;</span><span class="hl-0">;</span><br/><span class="hl-2">import</span><span class="hl-0"> { </span><span class="hl-1">Rareza</span><span class="hl-0"> } </span><span class="hl-2">from</span><span class="hl-0"> </span><span class="hl-3">&#39;../../src/Cartas/ERareza.js&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-6">describe</span><span class="hl-0">(</span><span class="hl-3">&#39;Colección de Cartas&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">  </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">colección</span><span class="hl-0">: </span><span class="hl-7">CardCollection</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">usuarioPrueba</span><span class="hl-0"> = </span><span class="hl-3">&#39;testUser&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">dirPath</span><span class="hl-0"> = </span><span class="hl-3">`./data/</span><span class="hl-4">${</span><span class="hl-1">usuarioPrueba</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-0">;</span><br/><br/><span class="hl-0">  </span><span class="hl-6">beforeEach</span><span class="hl-0">(() </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// Preparamos el directorio</span><br/><span class="hl-0">    </span><span class="hl-2">if</span><span class="hl-0"> (!</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">mkdirSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0"> = </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">usuarioPrueba</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">afterEach</span><span class="hl-0">(() </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// Limpiamos el directorio</span><br/><span class="hl-0">    </span><span class="hl-2">if</span><span class="hl-0"> (</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">rmSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería añadir una nueva carta a la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">card</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Prueba&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Reglas de prueba&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">10</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería evitar añadir una carta duplicada&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">card</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">, </span><span class="hl-8">// Mismo ID que la prueba anterior</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Duplicado&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">3</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Rojo</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Instantáneo</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Infrecuente</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Reglas duplicadas&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">5</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">card</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería eliminar una carta existente de la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">3</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">10</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">carta</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">removeCard</span><span class="hl-0">(</span><span class="hl-10">1</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">  </span><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería leer la información de una carta específica en la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-10">3</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> [</span><span class="hl-10">2</span><span class="hl-0">, </span><span class="hl-10">2</span><span class="hl-0">],</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">10</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta2</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 2&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Rojo</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Planeswalker</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Rara</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 2&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">marcasLealtad:</span><span class="hl-0"> </span><span class="hl-10">4</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">20</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">carta</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">carta2</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">result1</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">readCard</span><span class="hl-0">(</span><span class="hl-10">1</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedDescription</span><span class="hl-0"> = </span><span class="hl-3">`</span><span class="hl-9">\n</span><span class="hl-3">Información de la carta con ID 1</span><span class="hl-9">\n</span><span class="hl-3">Nombre: Carta 1</span><span class="hl-9">\n</span><span class="hl-3">Coste de Mana: 3</span><span class="hl-9">\n</span><span class="hl-3">Color: Azul</span><span class="hl-9">\n</span><span class="hl-3">Tipo de Línea: Criatura</span><span class="hl-9">\n</span><span class="hl-3">Rareza: Común</span><span class="hl-9">\n</span><span class="hl-3">Texto de Reglas: Texto de reglas para Carta 1</span><span class="hl-9">\n</span><span class="hl-3">Fuerza/Resistencia: 2/2</span><span class="hl-9">\n</span><span class="hl-3">Valor de Mercado: 10</span><span class="hl-9">\n</span><span class="hl-3">`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">result1</span><span class="hl-0">.</span><span class="hl-6">replace</span><span class="hl-0">(</span><span class="hl-11">/</span><span class="hl-4">\x1b</span><span class="hl-9">\[</span><span class="hl-12">[</span><span class="hl-11">0-9;</span><span class="hl-12">]</span><span class="hl-13">*</span><span class="hl-11">m/</span><span class="hl-4">g</span><span class="hl-0">, </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedDescription</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">result2</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">readCard</span><span class="hl-0">(</span><span class="hl-10">2</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedDescription2</span><span class="hl-0"> = </span><span class="hl-3">`</span><span class="hl-9">\n</span><span class="hl-3">Información de la carta con ID 2</span><span class="hl-9">\n</span><span class="hl-3">Nombre: Carta 2</span><span class="hl-9">\n</span><span class="hl-3">Coste de Mana: 2</span><span class="hl-9">\n</span><span class="hl-3">Color: Rojo</span><span class="hl-9">\n</span><span class="hl-3">Tipo de Línea: Planeswalker</span><span class="hl-9">\n</span><span class="hl-3">Rareza: Rara</span><span class="hl-9">\n</span><span class="hl-3">Texto de Reglas: Texto de reglas para Carta 2</span><span class="hl-9">\n</span><span class="hl-3">Marcas de Lealtad: 4</span><span class="hl-9">\n</span><span class="hl-3">Valor de Mercado: 20</span><span class="hl-9">\n</span><span class="hl-3">`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">result2</span><span class="hl-0">.</span><span class="hl-6">replace</span><span class="hl-0">(</span><span class="hl-11">/</span><span class="hl-4">\x1b</span><span class="hl-9">\[</span><span class="hl-12">[</span><span class="hl-11">0-9;</span><span class="hl-12">]</span><span class="hl-13">*</span><span class="hl-11">m/</span><span class="hl-4">g</span><span class="hl-0">, </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedDescription2</span><span class="hl-0">);</span><br/><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería cargar la colección desde archivos existentes&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// Simulamos que ya existe un directorio de usuario con archivos de cartas guardados</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">userDirPath</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">getUserDirPath</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-2">if</span><span class="hl-0"> (!</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">userDirPath</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">mkdirSync</span><span class="hl-0">(</span><span class="hl-1">userDirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">    </span><span class="hl-8">// Creamos archivos de cartas en el directorio de usuario</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta1</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">3</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">10</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta2</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 2&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Rojo</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Instantáneo</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Rara</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 2&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">20</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(() </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">loadCollection</span><span class="hl-0">()).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">not</span><span class="hl-0">.</span><span class="hl-6">throw</span><span class="hl-0">();</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería mostrar un mensaje de error si se intenta agregar una carta con un ID que ya existe en la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cartaExistente</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta Existente&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">3</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Verde</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Rara</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta Existente&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">15</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Añadimos una carta existente a la colección</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">cartaExistente</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Redefinimos console.log para capturar su salida</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">originalConsoleLog</span><span class="hl-0"> = </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">loggedMessage</span><span class="hl-0"> = </span><span class="hl-3">&quot;&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0"> = (</span><span class="hl-1">message</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">loggedMessage</span><span class="hl-0"> += </span><span class="hl-1">message</span><span class="hl-0">;</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Intentamos agregar la misma carta nuevamente</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">cartaExistente</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Restauramos console.log a su implementación original</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0"> = </span><span class="hl-1">originalConsoleLog</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Verificamos que se haya mostrado el mensaje de error correcto</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedErrorMessage</span><span class="hl-0"> = </span><span class="hl-3">&#39;&#39;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">loggedMessage</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedErrorMessage</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">  </span><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería mostrar un mensaje de error si se intenta actualizar una carta que no existe en la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cartaInexistente</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">100</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta Inexistente&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">5</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Blanco</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Conjuro</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Mítica</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta Inexistente&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">30</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">result1</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">updateCard</span><span class="hl-0">(</span><span class="hl-1">cartaInexistente</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedDescription</span><span class="hl-0"> = </span><span class="hl-3">`La carta con ID 100 no existe en la colección de </span><span class="hl-4">${</span><span class="hl-1">usuarioPrueba</span><span class="hl-4">}</span><span class="hl-3">.`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">result1</span><span class="hl-0">.</span><span class="hl-6">replace</span><span class="hl-0">(</span><span class="hl-11">/</span><span class="hl-4">\x1b</span><span class="hl-9">\[</span><span class="hl-12">[</span><span class="hl-11">0-9;</span><span class="hl-12">]</span><span class="hl-13">*</span><span class="hl-11">m/</span><span class="hl-4">g</span><span class="hl-0">, </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedDescription</span><span class="hl-0">);</span><br/><span class="hl-0">  });  </span><br/><span class="hl-0">  </span><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería mostrar un mensaje de error si se intenta eliminar una carta que no existe en la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">idInexistente</span><span class="hl-0"> = </span><span class="hl-10">100</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Redefinimos console.log para capturar su salida</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">originalConsoleLog</span><span class="hl-0"> = </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">loggedMessage</span><span class="hl-0"> = </span><span class="hl-3">&quot;&quot;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0"> = (</span><span class="hl-1">message</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">loggedMessage</span><span class="hl-0"> += </span><span class="hl-1">message</span><span class="hl-0">;</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Intentamos eliminar una carta que no existe</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">removeCard</span><span class="hl-0">(</span><span class="hl-10">999</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Restauramos console.log a su implementación original</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0"> = </span><span class="hl-1">originalConsoleLog</span><span class="hl-0">;</span><br/><span class="hl-0">  </span><br/><span class="hl-0">    </span><span class="hl-8">// Verificamos que se haya mostrado el mensaje de error correcto</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedErrorMessage</span><span class="hl-0"> = </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">loggedMessage</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedErrorMessage</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">  </span><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería mostrar un mensaje de error si la carta con el ID especificado no existe en la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">result1</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">readCard</span><span class="hl-0">(</span><span class="hl-10">100</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedDescription</span><span class="hl-0"> = </span><span class="hl-3">`La carta con ID 100 no existe en la colección de </span><span class="hl-4">${</span><span class="hl-1">usuarioPrueba</span><span class="hl-4">}</span><span class="hl-3">.`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">result1</span><span class="hl-0">.</span><span class="hl-6">replace</span><span class="hl-0">(</span><span class="hl-11">/</span><span class="hl-4">\x1b</span><span class="hl-9">\[</span><span class="hl-12">[</span><span class="hl-11">0-9;</span><span class="hl-12">]</span><span class="hl-13">*</span><span class="hl-11">m/</span><span class="hl-4">g</span><span class="hl-0">, </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedDescription</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería crear el directorio del usuario si no existe cuando se carga la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// El directorio debería ser creado por el constructor a través de loadCollection</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">be</span><span class="hl-0">.</span><span class="hl-1">true</span><span class="hl-0">;</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería manejar correctamente la situación cuando el directorio del usuario ya existe&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">mkdirSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">be</span><span class="hl-0">.</span><span class="hl-1">true</span><span class="hl-0">; </span><span class="hl-8">// El directorio ya existe</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// Crearmos una nueva instancia de CardCollection no debería lanzar error</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(() </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-4">new</span><span class="hl-0"> </span><span class="hl-6">CardCollection</span><span class="hl-0">(</span><span class="hl-1">usuarioPrueba</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">not</span><span class="hl-0">.</span><span class="hl-6">throw</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">be</span><span class="hl-0">.</span><span class="hl-1">true</span><span class="hl-0">; </span><span class="hl-8">// El directorio todavía existe</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería crear el directorio del usuario si no existe al cargar la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// Eliminamos el directorio si existe para probar la creación</span><br/><span class="hl-0">    </span><span class="hl-2">if</span><span class="hl-0"> (</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)) {</span><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">rmdirSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// Cargamos la colección, lo que debería crear el directorio</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">loadCollection</span><span class="hl-0">();</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// Verificamos que el directorio ha sido creado</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">be</span><span class="hl-0">.</span><span class="hl-1">true</span><span class="hl-0">;</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería cargar cartas desde archivos existentes en el directorio del usuario&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-2">if</span><span class="hl-0"> (!</span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">existsSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">)) {</span><br/><span class="hl-0">        </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">mkdirSync</span><span class="hl-0">(</span><span class="hl-1">dirPath</span><span class="hl-0">, { </span><span class="hl-1">recursive:</span><span class="hl-0"> </span><span class="hl-4">true</span><span class="hl-0"> });</span><br/><span class="hl-0">      }</span><br/><br/><span class="hl-0">      </span><span class="hl-8">// Creamos un archivo de carta de prueba en el directorio</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cartaPrueba</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">        </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta de Prueba&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Regla de prueba&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">100</span><br/><span class="hl-0">      };</span><br/><span class="hl-0">      </span><span class="hl-1">fs</span><span class="hl-0">.</span><span class="hl-6">writeFileSync</span><span class="hl-0">(</span><span class="hl-3">`</span><span class="hl-4">${</span><span class="hl-1">dirPath</span><span class="hl-4">}</span><span class="hl-3">/1.json`</span><span class="hl-0">, </span><span class="hl-5">JSON</span><span class="hl-0">.</span><span class="hl-6">stringify</span><span class="hl-0">(</span><span class="hl-1">cartaPrueba</span><span class="hl-0">));</span><br/><br/><span class="hl-0">      </span><span class="hl-8">// Cargamos la colección, lo que debería leer el archivo de carta creado</span><br/><span class="hl-0">      </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">loadCollection</span><span class="hl-0">();</span><br/><br/><span class="hl-0">      </span><span class="hl-8">// Verificamos que la carta ha sido cargada en la colección</span><br/><span class="hl-0">      </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cartaCargada</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">getCards</span><span class="hl-0">().</span><span class="hl-6">find</span><span class="hl-0">(</span><span class="hl-1">c</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">c</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0"> === </span><span class="hl-1">cartaPrueba</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">);</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaCargada</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">not</span><span class="hl-0">.</span><span class="hl-1">be</span><span class="hl-0">.</span><span class="hl-1">undefined</span><span class="hl-0">;</span><br/><span class="hl-0">      </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaCargada</span><span class="hl-0">?.</span><span class="hl-1">nombre</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaPrueba</span><span class="hl-0">.</span><span class="hl-1">nombre</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería actualizar una carta existente en la colección&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">3</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">10</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">carta</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cartaActualizada</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 1 Actualizada&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">4</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Rojo</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Conjuro</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Rara</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 1 Actualizada&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">20</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">originalConsoleLog</span><span class="hl-0"> = </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">let</span><span class="hl-0"> </span><span class="hl-1">loggedMessage</span><span class="hl-0"> = </span><span class="hl-3">&quot;&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// Redefinimos console.log para capturar su salida</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-6">log</span><span class="hl-0"> = (</span><span class="hl-1">message</span><span class="hl-0">) </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">      </span><span class="hl-1">loggedMessage</span><span class="hl-0"> += </span><span class="hl-1">message</span><span class="hl-0">;</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">updateCard</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// Restauramos console.log a su implementación original</span><br/><span class="hl-0">    </span><span class="hl-1">console</span><span class="hl-0">.</span><span class="hl-1">log</span><span class="hl-0"> = </span><span class="hl-1">originalConsoleLog</span><span class="hl-0">;</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">cartaActualizadaEnColección</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">getCards</span><span class="hl-0">().</span><span class="hl-6">find</span><span class="hl-0">(</span><span class="hl-1">c</span><span class="hl-0"> </span><span class="hl-4">=&gt;</span><span class="hl-0"> </span><span class="hl-1">c</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0"> === </span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">id</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-1">not</span><span class="hl-0">.</span><span class="hl-1">be</span><span class="hl-0">.</span><span class="hl-1">undefined</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">?.</span><span class="hl-1">nombre</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">nombre</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">?.</span><span class="hl-1">costeMana</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">costeMana</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">?.</span><span class="hl-1">color</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">color</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">?.</span><span class="hl-1">líneaTipo</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">líneaTipo</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">?.</span><span class="hl-1">rareza</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">rareza</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">?.</span><span class="hl-1">textoReglas</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">textoReglas</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">cartaActualizadaEnColección</span><span class="hl-0">?.</span><span class="hl-1">valorMercado</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">cartaActualizada</span><span class="hl-0">.</span><span class="hl-1">valorMercado</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería mostrar todas las cartas de la colección de un usuario&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta1</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">1</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">3</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Azul</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Criatura</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Común</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 1&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">fuerzaResistencia:</span><span class="hl-0"> [</span><span class="hl-10">2</span><span class="hl-0">, </span><span class="hl-10">2</span><span class="hl-0">],</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">10</span><br/><span class="hl-0">    };</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">carta2</span><span class="hl-0">: </span><span class="hl-7">Card</span><span class="hl-0"> = {</span><br/><span class="hl-0">      </span><span class="hl-1">id:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">nombre:</span><span class="hl-0"> </span><span class="hl-3">&#39;Carta 2&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">costeMana:</span><span class="hl-0"> </span><span class="hl-10">2</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">color:</span><span class="hl-0"> </span><span class="hl-1">Color</span><span class="hl-0">.</span><span class="hl-1">Rojo</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">líneaTipo:</span><span class="hl-0"> </span><span class="hl-1">TipoLinea</span><span class="hl-0">.</span><span class="hl-1">Planeswalker</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">rareza:</span><span class="hl-0"> </span><span class="hl-1">Rareza</span><span class="hl-0">.</span><span class="hl-1">Rara</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">textoReglas:</span><span class="hl-0"> </span><span class="hl-3">&#39;Texto de reglas para Carta 2&#39;</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">marcasLealtad:</span><span class="hl-0"> </span><span class="hl-10">4</span><span class="hl-0">,</span><br/><span class="hl-0">      </span><span class="hl-1">valorMercado:</span><span class="hl-0"> </span><span class="hl-10">20</span><br/><span class="hl-0">    };</span><br/><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">carta1</span><span class="hl-0">);</span><br/><span class="hl-0">    </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">addCard</span><span class="hl-0">(</span><span class="hl-1">carta2</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">result1</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">listCards</span><span class="hl-0">();</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedDescription</span><span class="hl-0"> = </span><span class="hl-3">`</span><span class="hl-9">\n</span><span class="hl-3">Colección de cartas de </span><span class="hl-4">${</span><span class="hl-1">usuarioPrueba</span><span class="hl-4">}</span><span class="hl-9">\n</span><span class="hl-3">--------------------------------</span><span class="hl-9">\n</span><span class="hl-3">ID: 1</span><span class="hl-9">\n</span><span class="hl-3">Nombre: Carta 1</span><span class="hl-9">\n</span><span class="hl-3">Coste de Mana: 3</span><span class="hl-9">\n</span><span class="hl-3">Color: Azul</span><span class="hl-9">\n</span><span class="hl-3">Tipo de Línea: Criatura</span><span class="hl-9">\n</span><span class="hl-3">Rareza: Común</span><span class="hl-9">\n</span><span class="hl-3">Texto de Reglas: Texto de reglas para Carta 1</span><span class="hl-9">\n</span><span class="hl-3">Fuerza/Resistencia: 2/2</span><span class="hl-9">\n</span><span class="hl-3">Valor de Mercado: 10</span><span class="hl-9">\n</span><span class="hl-3">--------------------------------</span><span class="hl-9">\n</span><span class="hl-3">--------------------------------</span><span class="hl-9">\n</span><span class="hl-3">ID: 2</span><span class="hl-9">\n</span><span class="hl-3">Nombre: Carta 2</span><span class="hl-9">\n</span><span class="hl-3">Coste de Mana: 2</span><span class="hl-9">\n</span><span class="hl-3">Color: Rojo</span><span class="hl-9">\n</span><span class="hl-3">Tipo de Línea: Planeswalker</span><span class="hl-9">\n</span><span class="hl-3">Rareza: Rara</span><span class="hl-9">\n</span><span class="hl-3">Texto de Reglas: Texto de reglas para Carta 2</span><span class="hl-9">\n</span><span class="hl-3">Marcas de Lealtad: 4</span><span class="hl-9">\n</span><span class="hl-3">Valor de Mercado: 20</span><span class="hl-9">\n</span><span class="hl-3">--------------------------------</span><span class="hl-9">\n</span><span class="hl-3">`</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">result1</span><span class="hl-0">.</span><span class="hl-6">replace</span><span class="hl-0">(</span><span class="hl-11">/</span><span class="hl-4">\x1b</span><span class="hl-9">\[</span><span class="hl-12">[</span><span class="hl-11">0-9;</span><span class="hl-12">]</span><span class="hl-13">*</span><span class="hl-11">m/</span><span class="hl-4">g</span><span class="hl-0">, </span><span class="hl-3">&#39;&#39;</span><span class="hl-0">)).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedDescription</span><span class="hl-0">);</span><br/><span class="hl-0">  });</span><br/><span class="hl-0">  </span><br/><span class="hl-0">  </span><span class="hl-6">it</span><span class="hl-0">(</span><span class="hl-3">&#39;debería devolver el color negro si el color no se encuentra&#39;</span><span class="hl-0">, () </span><span class="hl-4">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">colorInexistente</span><span class="hl-0"> = </span><span class="hl-3">&#39;UnColorInexistente&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">expectedColorCode</span><span class="hl-0"> = </span><span class="hl-3">&#39;#000000&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">    </span><span class="hl-4">const</span><span class="hl-0"> </span><span class="hl-5">actualColorCode</span><span class="hl-0"> = </span><span class="hl-1">colección</span><span class="hl-0">.</span><span class="hl-6">getColorCode</span><span class="hl-0">(</span><span class="hl-1">colorInexistente</span><span class="hl-0">);</span><br/><br/><span class="hl-0">    </span><span class="hl-6">expect</span><span class="hl-0">(</span><span class="hl-1">actualColorCode</span><span class="hl-0">).</span><span class="hl-1">to</span><span class="hl-0">.</span><span class="hl-6">equal</span><span class="hl-0">(</span><span class="hl-1">expectedColorCode</span><span class="hl-0">);</span><br/><span class="hl-0">  });  </span><br/><span class="hl-0">});</span>
</code><button>Copy</button></pre>
<a id="md:automatización-de-pruebas-con-github-actions" class="tsd-anchor"></a><h3><a href="#md:automatización-de-pruebas-con-github-actions">Automatización de Pruebas con GitHub Actions</a></h3><p>Para integrar las pruebas en el ciclo de vida del desarrollo y asegurar la calidad del código continuamente, utilizamos GitHub Actions para automatizar la ejecución de pruebas en cada push o pull request. Este enfoque garantiza que todas las contribuciones al código pasen por un proceso de validación antes de su integración, facilitando el mantenimiento de un código base sólido y funcional.</p>
<p>La implementación de este enfoque de &quot;code-then-test&quot;, junto con la automatización de pruebas, constituye una estrategia efectiva para desarrollar y validar la aplicación, asegurando que cumpla con los estándares de calidad requeridos y funcione según lo esperado.</p>
<a id="md:7-conclusión" class="tsd-anchor"></a><h2><a href="#md:7-conclusión">7. Conclusión</a></h2><p>Completar el proyecto de la aplicación cliente-servidor para la gestión de colecciones de cartas Magic ha sido un ejercicio sumamente enriquecedor desde el punto de vista técnico. Este proyecto ha permitido aplicar conocimientos adquiridos en clase en un entorno de desarrollo real, enfrentando desafíos típicos de la programación de red y el manejo de datos persistente.</p>
<p>El enfoque de implementación primero y pruebas después (&quot;code-then-test&quot;) ha demostrado ser adecuado para este proyecto. Aunque inicialmente parecía ir en contra de las tendencias actuales como TDD, este método permitió una mayor flexibilidad en las fases iniciales de desarrollo y proporcionó claridad sobre las funcionalidades a probar. Las pruebas unitarias y de integración se convirtieron en un pilar fundamental para asegurar la calidad del código y la correcta interacción entre el cliente y el servidor.</p>
<p>La automatización de pruebas mediante GitHub Actions ha reforzado la importancia de la integración y entrega continuas en el ciclo de desarrollo moderno. Esta práctica no solo optimizó el proceso de validación del código, sino que también incrementó la confianza en la estabilidad y funcionalidad de la aplicación ante cada nuevo cambio introducido.</p>
<p>A lo largo del desarrollo, la gestión de conexiones asincrónicas y la persistencia de datos representaron desafíos significativos, pero superar estos obstáculos ha sido una oportunidad invaluable de aprendizaje y crecimiento profesional. La experiencia ha subrayado la importancia de elegir las herramientas adecuadas y aplicar buenas prácticas de diseño y programación.</p>
<p>Este proyecto ha sido una afirmación del potencial de Node.js y el ecosistema Typescript para el desarrollo de aplicaciones robustas y eficientes. Concluimos este proyecto con un sentido de logro y con anticipación por las oportunidades futuras para continuar aprendiendo y desarrollando soluciones innovadoras en el campo de la ingeniería de software.</p>
<a id="md:8-referencias-bibliográficas" class="tsd-anchor"></a><h2><a href="#md:8-referencias-bibliográficas">8. Referencias Bibliográficas</a></h2><ul>
<li><a href="https://nodejs.org/en/docs/"><em>Documentación Node.js</em></a>  </li>
<li><a href="https://docs.sonarsource.com/sonarcloud/?_gl=1*7gzv7o*_gcl_au*OTcwMDc2NTEzLjE3MTAyODczOTQ.*_ga*MTg1NTg1MjA5LjE3MTAyODczODA.*_ga_9JZ0GZ5TC6*MTcxMTA2MDA3Ni42LjEuMTcxMTA2MDA3Ni42MC4wLjA."><em>Documentación SonarCloud</em></a>  </li>
<li><a href="https://docs.github.com/en/actions"><em>Documentación Github Actions</em></a>  </li>
<li><a href="https://github.com/chalk/chalk"><em>Documentación Chalk</em></a>  </li>
<li><a href="https://github.com/yargs/yargs"><em>Documentación Yargs</em></a>  </li>
<li><a href="https://nodejs.org/docs/latest/api/events.html"><em>Documentación de EventEmitter en Node.js</em></a>  </li>
<li><a href="https://nodejs.org/docs/latest/api/fs.html"><em>Documentación del módulo fs en Node.js</em></a>  </li>
<li><a href="https://nodejs.org/docs/latest/api/net.html"><em>Documentación del módulo net en Node.js</em></a>  </li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/prct10-fs-proc-sockets-magic-app/"><em>Práctica 10 - Aplicación cliente-servidor para coleccionistas de cartas Magic</em></a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:informe-de-práctica-10-aplicación-cliente-servidor-para-coleccionistas-de-cartas-magic"><span>Informe de <wbr/>Práctica 10: <wbr/>Aplicación cliente-<wbr/>servidor para coleccionistas de cartas <wbr/>Magic</span></a><ul><li><a href="#md:status-badges"><span>Status <wbr/>Badges</span></a></li><li><a href="#md:índice"><span>Índice:</span></a></li><li><a href="#md:1-objetivo"><span>1. <wbr/>Objetivo</span></a></li><li><a href="#md:2-tareas-previas"><span>2. <wbr/>Tareas <wbr/>Previas</span></a></li><li><a href="#md:3-arquitectura-de-la-aplicación"><span>3. <wbr/>Arquitectura de la <wbr/>Aplicación</span></a></li><li><ul><li><a href="#md:diseño-cliente-servidor"><span>Diseño <wbr/>Cliente-<wbr/>Servidor</span></a></li><li><a href="#md:gestión-de-conexiones"><span>Gestión de <wbr/>Conexiones</span></a></li><li><a href="#md:persistencia-de-datos"><span>Persistencia de <wbr/>Datos</span></a></li></ul></li><li><a href="#md:4-implementación-del-servidor"><span>4. <wbr/>Implementación del <wbr/>Servidor</span></a></li><li><ul><li><a href="#md:estructura-de-directorios-y-ficheros"><span>Estructura de <wbr/>Directorios y <wbr/>Ficheros</span></a></li><li><a href="#md:manejo-de-peticiones"><span>Manejo de <wbr/>Peticiones</span></a></li><li><a href="#md:código-propuesto-para-el-servidor"><span>Código <wbr/>Propuesto para el <wbr/>Servidor</span></a></li></ul></li><li><a href="#md:5-implementación-del-cliente"><span>5. <wbr/>Implementación del <wbr/>Cliente</span></a></li><li><ul><li><a href="#md:interfaz-de-línea-de-comandos-cli"><span>Interfaz de <wbr/>Línea de <wbr/>Comandos (CLI)</span></a></li><li><a href="#md:construcción-y-envío-de-peticiones"><span>Construcción y <wbr/>Envío de <wbr/>Peticiones</span></a></li><li><a href="#md:recepción-y-procesamiento-de-respuestas"><span>Recepción y <wbr/>Procesamiento de <wbr/>Respuestas</span></a></li><li><a href="#md:código-propuesto-para-el-cliente"><span>Código <wbr/>Propuesto para el <wbr/>Cliente</span></a></li></ul></li><li><a href="#md:6-pruebas-y-validación"><span>6. <wbr/>Pruebas y <wbr/>Validación</span></a></li><li><ul><li><a href="#md:metodología-code-then-test"><span>Metodología <wbr/>Code-<wbr/>Then-<wbr/>Test</span></a></li><li><a href="#md:pruebas-implementadas"><span>Pruebas <wbr/>Implementadas</span></a></li><li><a href="#md:automatización-de-pruebas-con-github-actions"><span>Automatización de <wbr/>Pruebas con <wbr/>Git<wbr/>Hub <wbr/>Actions</span></a></li></ul></li><li><a href="#md:7-conclusión"><span>7. <wbr/>Conclusión</span></a></li><li><a href="#md:8-referencias-bibliográficas"><span>8. <wbr/>Referencias <wbr/>Bibliográficas</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>ull-esit-inf-dsi-23-24-prct10-fs-proc-sockets-magic-app-alu0101515458</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>